---
title: "2020.04.06-개발일지"
excerpt: "리플렉션을 이용하여 깔끔하게 코딩하기"

categories:
 - dev_log
tags:
 - dev_log
 - java

class: wide
---



### 주제

1. 어떻게 하면 `switch 지옥`에서 벗어날 수 있을까?

   ![image-20200406201050358]({{site.baseurl}}/assets/img/2020-04-06-dev-log-1.png)

    ~~이게 뭐하는 짓이람~~

2. Commnad Line user Interface 환경에서 View 와 사용자 input를 어떻게 해야 연관성있게 가져갈 수 있을까?

![image-20200406201351383]({{site.baseurl}}/assets/img/2020-04-06-dev-log-2.png)

이렇게 하면 메뉴를 수정할 때 마다 `input` 관련해서 전부 수정해야 한다.

### 목표

코드를 깔끔하게... 수정하기 쉽게 ....



### 고민한 내용

- 디자인 패턴을 이용하여 개발

  기본적으로 그리고 당연하게도 `MVC` 로 개발하려 했으나, 사용자 입력을 어떻게 처리할 수 있을지 고민됨. `command pattern` 또는 `template pattern` 을 사용하려 했으나 마찬가지로 input이 자꾸 발목을 잡음



- 라이브러리를 사용해 볼것

  `spring shell project` 또는 [picoli](https://picocli.info/) 등이 검색됐으나, terminal 에서 명령어 사용하는 듯한 방식이라 리팩토링 수준이 아니라 아예 새로 작성하는 것과 같음. 오히려 shell script 작성하기 어려울때, 프로그래밍으로 하면 빠르게 할 수 있을때 사용하면 좋아보임



###### 결론) Spring에서의 `Controller` 같은 것을 만들자....!

사용자의 `input` 을 처리하는 클래스를 만들고 그것을 feature별로 패키지를 분리한다. 이때 factory pattern을 사용하면 switch문을 그냥쓰는 것이랑 다를바가 없어서 `Mapper`라고 불리는 annotaion을 만들기로 함 



### 알게된 내용

리플렉션 기능을 이용하려면 클래스 정보를 가져와야 한다. 객체는 자신의 클래스 정보 또는 인스턴스의 정보는 알 수 있으나 그 외에 정보는 알수가 없다. 즉, 실행되는 시점에 참조 불가능한 객체의 클래스 정보는 알수가 없다.... `ClassLoader` 를 이용해야 한다. 컨테이너를 직접 구현해야 하는데 이건 좀 미친짓인것 같아서 라이브러리를 사용하기로 했다. 



[`reflection`](https://github.com/ronmamo/reflections) 은 runtime 시점에 class의 다양한 정보를 가져올 수 있는 헬퍼 클래스다. reflection 을 이용하여 사용자 input을 감지하고 해당 메서드를 실행하게 하는 로직을 구현하였다.



##### 그결과.....

![image-20200406203840113]({{site.baseurl}}/assets/img/2020-04-06-dev-log-4.png)

사용자의 입력은 전부 `select` 메서드를 호출한다. select 메서드에서 `reflection` 을 이용하여   `@MenuMapper`가 선언된 클래스 객체를 전부 가져온다. 해당 객체 내부에 `@MenuMapping` 의 value가 사용자 입력과 같다면, 해당 함수를 호출한다.



![image-20200406203546037]({{site.baseurl}}/assets/img/2020-04-06-dev-log-3.png)

기존에 switch 문을 위와 같이 쪼개서 응집도를 낮추고 가독성을 높혔다.(~~맞나?~~) 



### 공부할 내용

리플렉션을 정리 한다면 좋을 것 같다....



